<!DOCTYPE html>
<html>
<head>
  <title>Android å¼€å‘ä¸­æ˜¯å¦åº”è¯¥ä½¿ç”¨æšä¸¾ï¼Ÿ-å’•å’šåŒå­¦</title>
  <meta charset="utf-8" />
  <meta http-equiv="content-language" content="zh-CN" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="supported-color-schemes" content="light dark">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="applicable-device" content="pc,mobile">
  <meta name="google-site-verification" content="ckhUaoa05QCmWoE1FafzTBcqYI4yBOy-UJKopXDS18M" />
  <meta name="author" content="å’•å’š" />
  <meta name="description" content="Android å¼€å‘ä¸­æ˜¯å¦åº”è¯¥ä½¿ç”¨æšä¸¾ï¼Ÿ"/>
  <meta name="keywords" content="å’•å’š,tech"/>
  <link rel="icon" href="/static/img/favicon.ico" />
  <link rel="apple-touch-icon" href="/static/img/logo.png" />
  <link rel="stylesheet" href="/static/css/common.css?t=20210703184356">
  <link rel="stylesheet" href="/static/css/theme-dark.css?t=20210703184356">
  <link rel="stylesheet" href="/static/css/post.css?t=20210703184356">
  <link rel="stylesheet" href="/static/css/code-dark.css?t=20210703184356">
  <link rel="stylesheet" href="/static/css/code-light.css?t=20210703184356">
  <script>
    window.blog = {
      baseurl:"",
      buildAt:"20210703184356",
      darkTheme: false,
      setDarkTheme: function (dark) {
        this.darkTheme = Boolean(dark);
        document.documentElement.className = this.darkTheme ? 'dark': '';
        document.querySelector('meta[name=theme-color]').setAttribute('content', this.darkTheme ? '#2D2E32': '#FFFFFF');
      }
    }
    if (sessionStorage.darkTheme !== undefined) {
      blog.setDarkTheme(sessionStorage.darkTheme === 'true'); // è®°å¿†å€¼ï¼Œå•ä¸ªçª—å£å†…æœ‰æ•ˆ
    } else {
      blog.setDarkTheme(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches); // è·Ÿéšç³»ç»Ÿ
    }

    if (window.matchMedia) {
      var media = window.matchMedia('(prefers-color-scheme: dark)');
      media.addListener(function (ev) {
        blog.setDarkTheme(ev.currentTarget.matches);
        sessionStorage.removeItem('darkTheme');
      });
    }
  </script>
</head><body ondragstart="return false;">
<header class="header">
  <img class="logo" src="/static/img/logo.jpg" alt="logo"/>
  <nav class="menu">
    <a href="/" class="hover-underline">é¦–é¡µ</a>
    <a href="/categories.html" class="hover-underline">å½’ç±»</a>
    <a href="/search.html" class="hover-underline">æœç´¢</a>
    <a href="/about.html" class="hover-underline">å…³äº</a>
    </nav>
</header>
<div class="page page-post">
  <h1 class="title" id="Android å¼€å‘ä¸­æ˜¯å¦åº”è¯¥ä½¿ç”¨æšä¸¾ï¼Ÿ">Android å¼€å‘ä¸­æ˜¯å¦åº”è¯¥ä½¿ç”¨æšä¸¾ï¼Ÿ</h1>
  
  <div class="subtitle">å’•å’š äº 2019-11-04 å‘å¸ƒ</div>
  
  <div class="post">
    <blockquote>
  <p>æœ¬æ–‡ç”±å’•å’šå‘å¸ƒåœ¨<a href="gudong.site/blog">ä¸ªäººåšå®¢</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>

  <p>æœ¬æ–‡æ°¸ä¹…åœ°å€ï¼š<a href="https://gudong.site/2019/11/04/use-enum-or-not.html">https://gudong.site/2019/11/04/use-enum-or-not.html</a></p>
</blockquote>

<hr />

<p>åœ¨ Android å®˜æ–¹æ–‡æ¡£æ¨å‡º<a href="https://developer.android.com/topic/performance/">æ€§èƒ½ä¼˜åŒ–</a>çš„æ—¶å€™ï¼Œä»ä¸€å¼€å§‹æœ‰è¿™æ ·ä¸€æ®µè¯´æ˜ï¼š</p>

<blockquote>
  <p>Enums often require more than twice as much memory as static constants. You should strictly avoid using enums on Android.</p>
</blockquote>

<p>æ„æ€æ˜¯è¯´åœ¨ Android å¹³å°ä¸Š <strong>avoid</strong> ä½¿ç”¨æšä¸¾ï¼Œå› ä¸ºæšä¸¾ç±»æ¯”ä¸€èˆ¬çš„é™æ€å¸¸é‡å¤šå ç”¨ä¸¤å€çš„ç©ºé—´ï¼ˆå¦‚æœä½ è¿˜ä¸äº†è§£æšä¸¾ï¼Œå‚çœ‹æ–‡ç«  <a href="../../../2019/11/08/enum-introduce.html">æšä¸¾ä»‹ç»ä»¥åŠæšä¸¾çš„æœ¬è´¨</a>ã€‚ï¼‰</p>

<p>ç”±äºæšä¸¾æœ€ç»ˆçš„å®ç°åŸç†è¿˜æ˜¯ç±»ï¼Œåœ¨ç¼–è¯‘å®Œæˆåï¼Œæœ€ç»ˆä¸ºæ¯ä¸€ç§ç±»å‹ç”Ÿæˆä¸€ä¸ªé™æ€å¯¹è±¡ï¼Œè€Œåœ¨å†…å­˜ç”³è¯·æ–¹é¢ï¼Œå¯¹è±¡éœ€è¦çš„å†…å­˜ç©ºé—´è¿œå¤§äºæ™®é€šçš„é™æ€å¸¸é‡ï¼Œè€Œä¸”åˆ†ææšä¸¾å¯¹è±¡çš„æˆå‘˜å˜é‡å¯çŸ¥ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡ä¸­é»˜è®¤éƒ½ä¼šæœ‰ä¸€ä¸ªå­—ç¬¦æ•°ç»„ç©ºé—´çš„ç”³è¯·ï¼Œè®¡ç®—ä¸‹æ¥ï¼Œæšä¸¾éœ€è¦çš„ç©ºé—´è¿œå¤§äºæ™®é€šçš„é™æ€å˜é‡ã€‚å…·ä½“åˆ†æå¯è§<a href="https://www.liaohuqiu.net/cn/posts/android-enum-memory-usage/">è¿™ç¯‡æ–‡ç« </a>ã€‚</p>

<p>æ‰€ä»¥ï¼Œç…§æ­¤æ¥çœ‹ï¼Œåœ¨ Android è¿™æ ·å¯¹å†…å­˜å¯¸åœŸå¿…äº‰çš„å¹³å°ä¸Šï¼Œå¦‚æœåªæ˜¯ä½¿ç”¨æšä¸¾æ¥æ ‡è®°ç±»å‹ï¼Œé‚£ä½¿ç”¨é™æ€å¸¸é‡ç¡®å®æ›´ä¼˜ï¼Œä½†æ˜¯ç°åœ¨ç¿»çœ‹å®˜æ–¹æ–‡æ¡£å‘ç°ï¼Œè¿™ä¸ªå»ºè®®å·²ç»è¢«åˆ é™¤äº†ã€‚</p>

<p>ä¸ºä»€ä¹ˆå®˜æ–¹ä¼šåˆ é™¤ï¼Ÿéš¾é“æ˜¯ä¹‹å‰çš„å»ºè®®æœ‰é”™è¯¯å—ï¼Œæˆ–è€…æè¿°çš„ä¸å¤Ÿç²¾ç¡®ï¼Ÿ</p>

<p>ä¸ªäººè®¤ä¸ºï¼Œæšä¸¾å ç”¨ç©ºé—´æ¯”æ™®é€šç±»å‹çš„é™æ€å¸¸é‡å¤§ï¼Œè¿™æ˜¯äº‹å®ï¼Œæ²¡é—®é¢˜ï¼Œä½†æ˜¯æ®æ­¤å°±å»ºè®®ä¸åœ¨ Android ä¸­ä½¿ç”¨æ—¶ä¸å¦¥çš„ï¼Œå…·ä½“çœ‹ JakeWharton åœ¨ reddit ä¸Šçš„ä¸€ä¸ª<a href="https://www.reddit.com/r/androiddev/comments/7so7ne/you_should_strictly_avoid_using_enums_on_android/?utm_source=share&amp;utm_medium=web2x">è¯„è®º</a>ã€‚</p>

<blockquote>
  <p>The fact that enums are full classes often gets overlooked. They can implement interfaces. They can have methods in the enum class and/or in each constant. And in the cases where you arenâ€™t doing that, ProGuard turns them back into ints anyway.</p>

  <p>The advice was wrong for application developers then. Itâ€™s remains wrong now.</p>
</blockquote>

<p>æœ€é‡è¦çš„ä¸€å¥æ˜¯</p>

<blockquote>
  <p>ProGuard turns them back into ints anyway.</p>
</blockquote>

<p><strong>åœ¨å¼€å¯ ProGuard ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œæšä¸¾ä¼šè¢«è½¬ä¸º int ç±»å‹</strong>ï¼Œæ‰€ä»¥å†…å­˜å ç”¨é—®é¢˜æ˜¯å¯ä»¥å¿½ç•¥çš„ã€‚å…·ä½“å¯å‚çœ‹ ProGuard çš„ä¼˜åŒ–åˆ—è¡¨é¡µé¢ <a href="http://proguard.sourceforge.net/manual/optimizations.html">Optimizations Page</a>ï¼Œå…¶ä¸­å°±åˆ—ä¸¾äº† enum è¢«ä¼˜åŒ–çš„é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<blockquote>
  <p>class/unboxing/enum</p>

  <p>Simplifies enum types to integer constants, whenever possible.</p>
</blockquote>

<p>æ—¢ç„¶ ProGuard ä¼šæŠŠæšä¸¾ä¼˜åŒ–ä¸ºæ•´å½¢ï¼Œé‚£æ˜¯ä¸æ˜¯åœ¨ Android ä¸­ï¼Œå°±å¯ä»¥ç»§ç»­æ— æ‰€é¡¾å¿Œçš„ä½¿ç”¨æšä¸¾äº†å‘¢ï¼ŸğŸ˜Š</p>

<p><strong>å¹¶ä¸æ˜¯ï¼ï¼ï¼</strong></p>

<p>ProGuard å¯¹æšä¸¾çš„ä¼˜åŒ–æœ‰ä¸€å®šçš„é™åˆ¶æ¡ä»¶ï¼Œå¦‚æœæšä¸¾ç±»å­˜åœ¨å¦‚ä¸‹çš„æƒ…å†µï¼Œå°†ä¸ä¼šæœ‰ä¼˜åŒ–ä¸ºæ•´å½¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<ol>
  <li>æšä¸¾å®ç°äº†è‡ªå®šä¹‰æ¥å£ã€‚å¹¶ä¸”è¢«è°ƒç”¨ã€‚</li>
  <li>ä»£ç ä¸­ä½¿ç”¨äº†ä¸åŒç­¾åæ¥å­˜å‚¨æšä¸¾ã€‚</li>
  <li>ä½¿ç”¨ instanceof æŒ‡ä»¤åˆ¤æ–­ã€‚</li>
  <li>åœ¨æšä¸¾åŠ é”æ“ä½œã€‚</li>
  <li>å¯¹æšä¸¾å¼ºè½¬ã€‚</li>
  <li>åœ¨ä»£ç ä¸­è°ƒç”¨é™æ€æ–¹æ³• valueOf æ–¹æ³•ã€‚</li>
  <li>å®šä¹‰å¯ä»¥å¤–éƒ¨è®¿é—®çš„æ–¹æ³•ã€‚</li>
</ol>

<blockquote>
  <p>å‚è€ƒè‡ªï¼š<a href="https://dim.red/2019/01/28/proguard_exploration/">ProGuard åˆæ¢ Â· dimâ€™s blog</a>ï¼Œå¦å¤–ï¼Œä¸Šé¢çš„è¿™ä¸ƒç§æƒ…å†µï¼Œæˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°å®˜æ–¹çš„è¯´æ˜ï¼Œå¦‚æœæœ‰å“ªä½è¯»è€…çŸ¥é“ï¼Œè¯·åœ¨è¯„è®ºåŒºé‡Œç•™ä¸‹é“¾æ¥ï¼Œè°¢è°¢å•¦~</p>
</blockquote>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦ä¿è¯æšä¸¾èƒ½è¢«æ­£å¸¸ä¼˜åŒ–ä¸ºæ•´å½¢ï¼Œå°±è¦ç¡®ä¿æšä¸¾è¶³å¤Ÿç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™äº›æƒ…å†µä¸‹çš„æšä¸¾éƒ½æ˜¯å¯ä»¥è¢«ä¼˜åŒ–çš„</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="nc">Color</span><span class="o">{</span>
  <span class="nc">Red</span><span class="o">,</span><span class="nc">Black</span><span class="o">,</span><span class="nc">Green</span>
<span class="o">}</span>
</code></pre></div></div>

<p>æˆ–è€…è¿™æ ·çš„</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="nc">Date</span> <span class="o">{</span>
  <span class="nc">Sunday</span><span class="o">(</span><span class="s">"æ˜ŸæœŸæ—¥"</span><span class="o">),</span> 
  <span class="nc">Monday</span><span class="o">(</span><span class="s">"æ˜ŸæœŸä¸€"</span><span class="o">),</span> 
  <span class="nc">Tuesday</span><span class="o">(</span><span class="s">"æ˜ŸæœŸäºŒ"</span><span class="o">),</span> 
  <span class="nc">Wednesday</span><span class="o">(</span><span class="s">"æ˜ŸæœŸä¸‰"</span><span class="o">),</span> 
  <span class="nc">Thursday</span><span class="o">(</span><span class="s">"æ˜ŸæœŸå››"</span><span class="o">),</span> 
  <span class="nc">Friday</span><span class="o">(</span><span class="s">"æ˜ŸæœŸäº”"</span><span class="o">),</span> 
  <span class="nc">Saturday</span><span class="o">(</span><span class="s">"æ˜ŸæœŸå…­"</span><span class="o">);</span>

  <span class="kd">public</span> <span class="nc">String</span> <span class="n">value</span><span class="o">;</span>

  <span class="kd">private</span> <span class="nf">Date</span><span class="o">(</span><span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ä½†æ˜¯å†æ¬¡æŸ¥çœ‹é‚£ä¸ƒæ¡è§„åˆ™ï¼Œä¼šå‘ç°è¿™å‡ ä¸ªè§„åˆ™å‡ ä¹æŠŠæšä¸¾é¢å‘å¯¹è±¡çš„ç‰¹æ€§éƒ½é™åˆ¶äº†ï¼Œåœ¨è¿™æ ·çš„é™åˆ¶ä¸‹ï¼Œæšä¸¾å¥½ç”¨çš„åœ°æ–¹éƒ½å°†æ¶ˆå¤±ï¼Œå¤±å»äº†æšä¸¾çš„çµæ´»æ€§ã€‚</p>

<p>åˆ°è¿™é‡Œå°±æœ‰ç‚¹çŸ›ç›¾äº†ï¼Œæšä¸¾å¾ˆå¥½ç”¨ï¼ŒProGuard ä¹Ÿä¼šå¯¹å®ƒè¿›è¡Œä¼˜åŒ–ï¼Œä½†æ˜¯ä¼˜åŒ–æ¡ä»¶é™åˆ¶äº†æˆ‘ä»¬æ›´å¥½çš„ä½¿ç”¨æšä¸¾ï¼Œé‚£æˆ‘ä»¬åº”è¯¥æ€ä¹ˆé¢å¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘çš„å‡ ç‚¹å»ºè®®ï¼š</p>

<ul>
  <li>å¯¹äºç®€å•çš„ä½¿ç”¨åœºæ™¯ï¼Œæ¯”å¦‚ Colorã€Week è¿™ç§ï¼Œæšä¸¾æœ‰æ›´å¥½çš„è¯­ä¹‰æ€§ï¼Œå¯ä»¥ä¼˜å…ˆä½¿ç”¨æšä¸¾ã€‚</li>
  <li>ä¸€äº›æ—¶å€™ä½¿ç”¨æšä¸¾å¯èƒ½æ— æ³•é¿å…ä¸Šé¢ä¸ƒç§æƒ…å†µçš„ï¼Œæƒè¡¡æ˜“ç”¨æ€§å’Œæ€§èƒ½ä»¥åŠä½¿ç”¨åœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘ç»§ç»­ä½¿ç”¨æšä¸¾ï¼Œå› ä¸ºæšä¸¾åœ¨æœ‰äº›æ—¶å€™ç¡®å®è®©ä»£ç æ›´ç®€æ´ï¼Œæ›´å®¹æ˜“ç»´æŠ¤ï¼Œç‰ºç‰²ç‚¹å†…å­˜ä¹Ÿæ— å¦¨ã€‚</li>
</ul>

<hr />

<p>è‡³äº Android ä¸ºä»€ä¹ˆä¼šæŠŠé‚£æ¡ä¼˜åŒ–å»ºè®®åˆ æ‰ï¼Œæˆ‘è®¤ä¸ºå®˜æ–¹ä¹Ÿæ˜¯è€ƒè™‘åˆ°äº†æšä¸¾ä¼šè¢«ä¼˜åŒ–ä¸ºæ•´å½¢è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥æ‰å»æ‰çš„ã€‚</p>

<p>ç„¶åå®é™…å·¥ä½œä¸­å…·ä½“æ€ä¹ˆä½¿ç”¨ï¼Œå®˜æ–¹å°±ä¸åœ¨è¯´  <strong>â€avoidâ€œ</strong> äº†ï¼Œè€Œæ˜¯è®©å¼€å‘è€…è‡ªè¡Œå†³å®šæ˜¯ä¸æ˜¯ä½¿ç”¨æšä¸¾ã€‚</p>

<p>ä»¥ä¸Šå°±æ˜¯å…³äº [Android å¼€å‘ä¸­æ˜¯å¦åº”è¯¥ä½¿ç”¨æšä¸¾ï¼Ÿ] è¿™ä¸ªé—®é¢˜æˆ‘çš„ä¸€äº›æ€è€ƒã€‚</p>

<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2>

<ul>
  <li><a href="https://www.liaohuqiu.net/cn/posts/android-enum-memory-usage/">Android ä¸­çš„ Enum åˆ°åº•å å¤šå°‘å†…å­˜ï¼Ÿè¯¥å¦‚ä½•ç”¨ï¼Ÿ | Yet Another Summer Rain</a></li>
  <li><a href="https://droidyue.com/blog/2016/11/29/dive-into-enum/">å…³äºJavaä¸­æšä¸¾Enumçš„æ·±å…¥å‰–æ - æŠ€æœ¯å°é»‘å±‹</a></li>
  <li><a href="https://stackoverflow.com/a/29972028/4318748">should-i-strictly-avoid-using-enums-on-android</a></li>
  <li><a href="https://www.reddit.com/r/androiddev/comments/7so7ne/you_should_strictly_avoid_using_enums_on_android/">â€œYou should strictly avoid using enums on Androidâ€ : androiddev</a></li>
  <li><a href="https://dim.red/2019/01/28/proguard_exploration/">ProGuard åˆæ¢ Â· dimâ€™s blog</a></li>
</ul>


  </div>
  
</div>
<footer class="footer">
  <span>Copyright Â© 2020 å’•å’š</span>
  <a href="/static/xml/rss.xml">RSSè®¢é˜…</a>
  <span>Theme By</span>
  <a href="https://github.com/TMaize/tmaize-blog">TMaize</a>
</footer>
<div id="to-top">
  <span></span>
  <span></span>
</div>
<script type="text/javascript" src="/static/js/blog.js?t=20210703184356"></script>
<script type="text/javascript" src="/static/js/search.js?t=20210703184356"></script><!-- ç™¾åº¦è‡ªåŠ¨æ¨é€ -->
<script>
  ;(function () {
    if (window.location.hostname == '127.0.0.1') {
      return
    }
    var bp = document.createElement('script')
    var curProtocol = window.location.protocol.split(':')[0]
    if (curProtocol === 'https') {
      bp.src = 'https://zz.bdstatic.com/linksubmit/push.js'
    } else {
      bp.src = 'http://push.zhanzhang.baidu.com/push.js'
    }
    var s = document.getElementsByTagName('script')[0]
    s.parentNode.insertBefore(bp, s)
  })()
</script>

</body>
</html>