---
layout: post
author: å’•å’š
title: "Android å¼€å‘ä¸­æ˜¯å¦åº”è¯¥ä½¿ç”¨æšä¸¾ï¼Ÿ"
description: åœ¨ Android å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªé—®é¢˜è¢«å¾ˆå¤šæ¬¡çš„æèµ·ï¼Œä¸å°‘æ–‡ç« åˆ†ææšä¸¾çš„å†…å­˜å ç”¨æƒ…å†µï¼Œåæ¥åœ¨ Android å®˜æ–¹çš„å†…å­˜ä¼˜åŒ–æ–‡æ¡£ä¸­æå‡ºï¼Œä¸å»ºè®®ä½¿ç”¨æšä¸¾ï¼Œä½†æ˜¯ç°åœ¨çš„å®˜æ–¹æ–‡æ¡£å´å·²å°†æ¬¡å»ºè®®åˆ é™¤ï¼Œè¿™èƒŒåéƒ½æœ‰å“ªäº›å€¼å¾—å…³å¿ƒçš„ä¸œè¥¿å‘¢ï¼Ÿä¸€èµ·çœ‹çœ‹... 
qrcode_mp: true
tags: Optimize Android Enum
categories: blog 
---


åœ¨ Android å®˜æ–¹æ–‡æ¡£æ¨å‡º[æ€§èƒ½ä¼˜åŒ–](https://developer.android.com/topic/performance/)çš„æ—¶å€™ï¼Œä»ä¸€å¼€å§‹æœ‰è¿™æ ·ä¸€æ®µè¯´æ˜ï¼š

> Enums often require more than twice as much memory as static constants. You should strictly avoid using enums on Android.

æ„æ€æ˜¯è¯´åœ¨ Android å¹³å°ä¸Š**é¿å…ä½¿ç”¨æšä¸¾ **ï¼Œå› ä¸ºæšä¸¾ç±»æ¯”ä¸€èˆ¬çš„é™æ€å¸¸é‡å¤šå ç”¨ä¸¤å€çš„ç©ºé—´ã€‚

> å¦‚æœä½ è¿˜ä¸äº†è§£æšä¸¾ï¼Œå‚çœ‹æ–‡ç«  [æšä¸¾ä»‹ç»ä»¥åŠæšä¸¾çš„æœ¬è´¨](../../../2019/11/08/enum-introduce.html)ã€‚

ç”±äºæšä¸¾æœ€ç»ˆçš„å®ç°åŸç†è¿˜æ˜¯ç±»ï¼Œåœ¨ç¼–è¯‘å®Œæˆåï¼Œæœ€ç»ˆä¸ºæ¯ä¸€ç§ç±»å‹ç”Ÿæˆä¸€ä¸ªé™æ€å¯¹è±¡ï¼Œè€Œåœ¨å†…å­˜ç”³è¯·æ–¹é¢ï¼Œå¯¹è±¡éœ€è¦çš„å†…å­˜ç©ºé—´è¿œå¤§äºæ™®é€šçš„é™æ€å¸¸é‡ï¼Œè€Œä¸”åˆ†ææšä¸¾å¯¹è±¡çš„æˆå‘˜å˜é‡å¯çŸ¥ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡ä¸­é»˜è®¤éƒ½ä¼šæœ‰ä¸€ä¸ªå­—ç¬¦æ•°ç»„ç©ºé—´çš„ç”³è¯·ï¼Œè®¡ç®—ä¸‹æ¥ï¼Œæšä¸¾éœ€è¦çš„ç©ºé—´è¿œå¤§äºæ™®é€šçš„é™æ€å˜é‡ã€‚å…·ä½“åˆ†æå¯è§[è¿™ç¯‡æ–‡ç« ](https://www.liaohuqiu.net/cn/posts/android-enum-memory-usage/)ã€‚

æ‰€ä»¥ï¼Œç…§æ­¤æ¥çœ‹ï¼Œåœ¨ Android è¿™æ ·å¯¹å†…å­˜å¯¸åœŸå¿…äº‰çš„å¹³å°ä¸Šï¼Œå¦‚æœåªæ˜¯ä½¿ç”¨æšä¸¾æ¥æ ‡è®°ç±»å‹ï¼Œé‚£ä½¿ç”¨é™æ€å¸¸é‡ç¡®å®æ›´ä¼˜ï¼Œä½†æ˜¯ç°åœ¨ç¿»çœ‹å®˜æ–¹æ–‡æ¡£å‘ç°ï¼Œè¿™ä¸ªå»ºè®®å·²ç»è¢«åˆ é™¤äº†ã€‚ï¼ˆ

ä¸ºä»€ä¹ˆå®˜æ–¹ä¼šåˆ é™¤ï¼Ÿéš¾é“æ˜¯ä¹‹å‰çš„å»ºè®®æœ‰é”™è¯¯å—ï¼Œæˆ–è€…æè¿°çš„ä¸å¤Ÿç²¾ç¡®ï¼Ÿ

ä¸ªäººè®¤ä¸ºï¼Œæšä¸¾å ç”¨ç©ºé—´æ¯”æ™®é€šç±»å‹çš„é™æ€å¸¸é‡å¤§ï¼Œè¿™æ˜¯äº‹å®ï¼Œæ²¡é—®é¢˜ï¼Œä½†æ˜¯æ®æ­¤å°±å»ºè®®ä¸åœ¨ Android ä¸­ä½¿ç”¨æ—¶ä¸å¦¥çš„ï¼Œå…·ä½“çœ‹ JakeWharton åœ¨ reddit ä¸Šçš„ä¸€ä¸ª[è¯„è®º](https://www.reddit.com/r/androiddev/comments/7so7ne/you_should_strictly_avoid_using_enums_on_android/?utm_source=share&utm_medium=web2x)

> The fact that enums are full classes often gets overlooked. They can implement interfaces. They can have methods in the enum class and/or in each constant. And in the cases where you aren't doing that, ProGuard turns them back into ints anyway.
>
> The advice was wrong for application developers then. It's remains wrong now.

æœ€é‡è¦çš„ä¸€å¥æ˜¯

> ProGuard turns them back into ints anyway.

> https://dim.red/2019/01/28/proguard_exploration/

ä»–çš„æ„æ€æ˜¯ Android ä¸­ï¼Œåœ¨å¼€å¯ ProGuard ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œæšä¸¾ä¼šè¢«è½¬ä¸º int ç±»å‹ï¼Œæ‰€ä»¥å†…å­˜å ç”¨é—®é¢˜æ˜¯å¯ä»¥å¿½ç•¥çš„ã€‚å…·ä½“å¯å‚çœ‹ ProGuard çš„ä¼˜åŒ–åˆ—è¡¨é¡µé¢ [Optimizations Page](http://proguard.sourceforge.net/manual/optimizations.html)ï¼Œå…¶ä¸­å°±æœ‰ enum é»˜è®¤è¢«ä¼˜åŒ–çš„ä¸€é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

> class/unboxing/enum
>
> Simplifies enum types to integer constants, whenever possible.

æ—¢ç„¶ ProGuard ä¼šæŠŠæšä¸¾ä¼˜åŒ–ä¸ºæ•´å½¢ï¼Œé‚£æ˜¯ä¸æ˜¯åœ¨ Android ä¸­ï¼Œå°±å¯ä»¥ç»§ç»­æ— æ‰€é¡¾å¿Œçš„ä½¿ç”¨æšä¸¾äº†å‘¢ï¼ŸğŸ˜Š

**å¹¶ä¸æ˜¯ï¼ï¼ï¼**

ProGuard åªä¼šå¯¹ç®€æ˜“ä½¿ç”¨çš„æšä¸¾æ‰ä¼šè¿›è¡Œæ•´å½¢ä¼˜åŒ–ï¼Œå¦‚ä¸‹æ‰€ç¤º

```java
enum Color{
  Red,Black,Green
}
```

æˆ–è€…è¿™æ ·çš„

```java
enum Date {
  Sunday("æ˜ŸæœŸæ—¥"), Monday("æ˜ŸæœŸä¸€"), Tuesday("æ˜ŸæœŸäºŒ"), Wednesday("æ˜ŸæœŸä¸‰"), Thursday(
    "æ˜ŸæœŸå››"), Friday("æ˜ŸæœŸäº”"), Saturday("æ˜ŸæœŸå…­");

  public String value;

  private Date(String value) {
    this.value = value;
  }
}
```

éƒ½æ²¡é—®é¢˜ï¼Œä¸Šé¢çš„æšä¸¾ä¼šåœ¨ ProGuard ä¼˜åŒ–æœŸé—´è¢«æ›¿æ¢ä¸ºæ•´å½¢ï¼Œä½†æ˜¯å¦‚æœæšä¸¾æœ‰ä¸‹å±æƒ…å†µï¼Œåˆ™ ProGuard ä¸ä¼šå¯¹æšä¸¾è¿›è¡Œä¼˜åŒ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

1. æšä¸¾å®ç°äº†è‡ªå®šä¹‰æ¥å£ã€‚å¹¶ä¸”è¢«è°ƒç”¨ã€‚
2. ä»£ç ä¸­ä½¿ç”¨äº†ä¸åŒç­¾åæ¥å­˜å‚¨æšä¸¾ã€‚
3. ä½¿ç”¨ instanceof æŒ‡ä»¤åˆ¤æ–­ã€‚
4. åœ¨æšä¸¾åŠ é”æ“ä½œã€‚
5. å¯¹æšä¸¾å¼ºè½¬ã€‚
6. åœ¨ä»£ç ä¸­è°ƒç”¨é™æ€æ–¹æ³• valueOf æ–¹æ³•ã€‚
7. å®šä¹‰å¯ä»¥å¤–éƒ¨è®¿é—®çš„æ–¹æ³•ã€‚

> å‚è€ƒè‡ªï¼š[ProGuard åˆæ¢ Â· dim's blog](https://dim.red/2019/01/28/proguard_exploration/)

æ‰€ä»¥ç°åœ¨å†æ¬¡è§£ç­” Android æ˜¯å¦åº”è¯¥ç”¨æšä¸¾è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬å°±åº”è¯¥ç»“åˆè‡ªå·±ä½¿ç”¨æšä¸¾çš„åœºæ™¯ï¼Œå»å…·ä½“çš„åˆ†æè¿™ä¸ªé—®é¢˜ã€‚

* ä¸€èˆ¬çš„ï¼Œå¯¹æšä¸¾æ²¡æœ‰å¤æ‚æ“ä½œçš„æƒ…å†µä¸‹ï¼Œéšæ„ä½¿ç”¨æšä¸¾ï¼Œå®ƒæœ‰æ›´å¥½è¯­ä¹‰æ€§ï¼Œä»£ç æ›´å¥½é˜…è¯»ã€‚
* è¦ç¡®å®šä½¿ç”¨æšä¸¾æ—¶ï¼Œç¡®ä¿ä½¿ç”¨åœºæ™¯ä¸ä¼šè§¦å‘ä¸Šé¢åˆ—ä¸¾çš„æƒ…å†µï¼Œå…·ä½“åæ¨ä¹‹
  * ä¸è¦è®©æšä¸¾å®ç°æ¥å£
  * å¦‚æœéœ€è¦è‡ªå®šä¹‰æ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆåªè‡ªå®šä¹‰ä¸€ä¸ªæœ‰å‚çš„æ„é€ æ–¹æ³•ã€‚
  * ä¸è¦å¯¹æšä¸¾è¿›è¡Œ instanceof åˆ¤æ–­
  * ä¸ä½¿ç”¨ valueOf æ–¹æ³•å®ä¾‹åŒ–æšä¸¾
  * ç­‰ç­‰...

> æ€è€ƒï¼Ÿæ˜¯ä¸æ˜¯å¯ä»¥å†™ä¸€ä¸ªä»£ç æ£€æµ‹å·¥å…·ï¼Œæ£€æµ‹é¡¹ç›®ä¸­çš„æšä¸¾æ˜¯å¦å¯ä»¥è¢«ä¼˜åŒ–ï¼Œå¦‚æœä¸èƒ½ï¼Œåˆ™æç¤ºå¼€å‘è€…ã€‚

è‡³äº Android ä¸ºä»€ä¹ˆä¼šæŠŠé‚£æ¡ä¼˜åŒ–å»ºè®®åˆ æ‰ï¼Œæˆ‘è®¤ä¸ºå®˜æ–¹å…«æˆä¹Ÿæ˜¯è€ƒè™‘åˆ°äº†æšä¸¾ä¼šè¢«ä¼˜åŒ–ä¸ºæ•´å½¢è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥æ‰å»æ‰çš„ã€‚è€Œä¸”å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½¿ç”¨æšä¸¾çš„åœºæ™¯éƒ½æ¯”è¾ƒè½»é‡ï¼Œå¹¶æ²¡æœ‰é‚£ä¹ˆå¤šå¤æ‚æƒ…å†µå­˜åœ¨ã€‚

ä½†æ˜¯çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œäº†è§£äº†è¿™äº›åï¼Œå†å»ä½¿ç”¨æšä¸¾ï¼Œå¿ƒé‡Œå°±ä¼šæ›´æœ‰åº•ã€‚



## å‚è€ƒé“¾æ¥

* [Android ä¸­çš„ Enum åˆ°åº•å å¤šå°‘å†…å­˜ï¼Ÿè¯¥å¦‚ä½•ç”¨ï¼Ÿ \| Yet Another Summer Rain](https://www.liaohuqiu.net/cn/posts/android-enum-memory-usage/)
* [å…³äºJavaä¸­æšä¸¾Enumçš„æ·±å…¥å‰–æ \- æŠ€æœ¯å°é»‘å±‹](https://droidyue.com/blog/2016/11/29/dive-into-enum/)
* [should-i-strictly-avoid-using-enums-on-android](https://stackoverflow.com/a/29972028/4318748)
* ["You should strictly avoid using enums on Android" : androiddev](https://www.reddit.com/r/androiddev/comments/7so7ne/you_should_strictly_avoid_using_enums_on_android/)
* [ProGuard åˆæ¢ Â· dim's blog](https://dim.red/2019/01/28/proguard_exploration/)

