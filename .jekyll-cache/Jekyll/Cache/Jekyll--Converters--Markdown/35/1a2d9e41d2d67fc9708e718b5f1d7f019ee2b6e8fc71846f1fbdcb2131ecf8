I"š4<h2 id="string">String</h2>

<p>å­—ç¬¦ä¸²å¸¸é‡ï¼Œä¸€æ—¦åˆ›å»ºï¼Œä¸å¯æ”¹å˜ã€‚è¿™é‡Œçš„ä¸å¯æ”¹å˜æŒ‡å­—ç¬¦ä¸²å¯¹åº”å †å†…å­˜ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œå­—ç¬¦ä¸²çš„åŠ æ“ä½œæ—¶ï¼Œå®é™…ä¸Šæ˜¯å¤åˆ¶è¢«åŠ å­—ç¬¦ä¸²çš„å†…å®¹åˆ°æ–°å¼€è¾Ÿçš„å­—ç¬¦ä¸²ç©ºé—´ä¸­ï¼ŒåŸæ¥çš„ä½œåºŸã€‚</p>

<p>String æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒString ç±»æ˜¯ final ç±»ï¼Œä¸å¯ä»¥è¢«ç»§æ‰¿ã€‚</p>

<p>String çš„é•¿åº¦æ˜¯ä¸å˜çš„ï¼Œé€‚ç”¨äºå°‘é‡çš„å­—ç¬¦ä¸²æ“ä½œã€‚</p>

<h2 id="stringbuffer">StringBuffer</h2>

<p>å­—ç¬¦ä¸²å˜é‡ï¼Œé•¿åº¦å¯å˜ï¼Œ<strong>çº¿ç¨‹å®‰å…¨</strong>ã€‚é€‚ç”¨äºå¤šçº¿ç¨‹ä¸‹åœ¨å­—ç¬¦ç¼“å†²åŒºè¿›è¡Œå¤§é‡å­—ç¬¦ä¸²æ“ä½œ</p>

<h2 id="stringbuilder">StringBuilder</h2>

<p>å­—ç¬¦ä¸²å˜é‡ï¼Œé•¿åº¦å¯å˜ï¼Œ<strong>çº¿ç¨‹ä¸å®‰å…¨</strong>ã€‚é€‚ç”¨äº<strong>å•çº¿ç¨‹</strong>ä¸‹åœ¨å­—ç¬¦ç¼“å†²åŒºè¿›è¡Œå¤§é‡å­—ç¬¦ä¸²æ“ä½œ</p>

<p>å­—ç¬¦ä¸²æ“ä½œåœ¨æ‰§è¡Œé€Ÿåº¦ï¼šStringBuilder &gt; StringBuffer &gt; String</p>

<h2 id="æºç åˆ†æ">æºç åˆ†æ</h2>

<blockquote>
  <p>åŸºäº Android SDK 26 ç‰ˆæœ¬åˆ†æ</p>
</blockquote>

<p>StringBuffer ä¸ StringBuilder å…±åŒç»§æ‰¿è‡ª AbstractStringBuilderï¼ŒäºŒè€…åŸºæœ¬çš„æ–¹æ³•è°ƒç”¨éƒ½æ˜¯ä½¿ç”¨äº†çˆ¶ç±»çš„å®ç°ï¼Œå­ç±»åªæ˜¯ç®€å•åŒ…è£…äº†ä¸€ä¸‹ï¼ŒåŒºåˆ«åœ¨äºï¼Œ<strong>StringBuffer æ”¯æŒå¤šçº¿ç¨‹ï¼Œæ‰€ä»¥å®ƒçš„æ“ä½œæ–¹æ³•å‡æ˜¯åŒæ­¥æ–¹æ³•</strong>ã€‚ è¿™é‡Œä½¿ç”¨ synchronized å…³é”®å­—æ ‡è®°æ–¹æ³•ä¸ºåŒæ­¥æ–¹æ³•ï¼Œæ‰€ä»¥å®ƒçš„æ•ˆç‡è¾ƒä½ï¼Œå› ä¸ºè°ƒç”¨åŒæ­¥æ–¹æ³•æ—¶ï¼Œé¦–å…ˆè¦å»è·å–åŒæ­¥é”ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kd">synchronized</span> <span class="nc">StringBuffer</span> <span class="nf">append</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">toStringCache</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="kd">super</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
  <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>AbstractStringBuilder å®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦æ•°ç»„ç”¨äºè¿›è¡Œæ‰€æœ‰çš„å­—ç¬¦å¤„ç†ï¼Œ</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* The value is used for character storage.
*/</span>
<span class="kt">char</span><span class="o">[]</span> <span class="n">value</span><span class="o">;</span>
</code></pre></div></div>

<p>ä½¿ç”¨é»˜è®¤çš„æ„é€ æ–¹æ³•æ—¶ï¼Œä¼šæŒ‡å®šåˆå§‹å­—ç¬¦æ•°ç»„çš„å¤§å°ä¸º 16ï¼Œå¦‚æœæ„é€ æ—¶æŒ‡å®šäº†åˆå§‹çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆåˆå§‹å®¹é‡ä¸ºå­—ç¬¦ä¸²é•¿åº¦åŠ  16ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nf">StringBuffer</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
	<span class="kd">super</span><span class="o">(</span><span class="n">str</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">+</span> <span class="mi">16</span><span class="o">);</span>
	<span class="n">append</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="append-æ–¹æ³•å®ç°">append æ–¹æ³•å®ç°</h3>

<p>append æ”¯æŒç©ºæ•°æ®ã€‚æ‰§è¡Œè¯¥æ–¹æ³•æ—¶ï¼Œä¼šé¦–å…ˆæ£€æŸ¥ append çš„å€¼æ˜¯å¦æ˜¯ nullï¼Œå¦‚æœæ˜¯ï¼Œå³å‚æ•°å€¼ä¸º nullï¼Œè¿™æ—¶ AbstractStringBuilder ä¼šæŠŠç©ºå€¼åšç‰¹æ®Šå¤„ç†ï¼Œæœ€ç»ˆåœ¨å­—ç¬¦æ•°ç»„ç»“å°¾è¿½åŠ  â€œnullâ€ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="nc">AbstractStringBuilder</span> <span class="nf">appendNull</span><span class="o">()</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">count</span><span class="o">;</span>
  <span class="n">ensureCapacityInternal</span><span class="o">(</span><span class="n">c</span> <span class="o">+</span> <span class="mi">4</span><span class="o">);</span>
  <span class="kd">final</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">value</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
  <span class="n">value</span><span class="o">[</span><span class="n">c</span><span class="o">++]</span> <span class="o">=</span> <span class="sc">'n'</span><span class="o">;</span>
  <span class="n">value</span><span class="o">[</span><span class="n">c</span><span class="o">++]</span> <span class="o">=</span> <span class="sc">'u'</span><span class="o">;</span>
  <span class="n">value</span><span class="o">[</span><span class="n">c</span><span class="o">++]</span> <span class="o">=</span> <span class="sc">'l'</span><span class="o">;</span>
  <span class="n">value</span><span class="o">[</span><span class="n">c</span><span class="o">++]</span> <span class="o">=</span> <span class="sc">'l'</span><span class="o">;</span>
  <span class="n">count</span> <span class="o">=</span> <span class="n">c</span><span class="o">;</span>
  <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å…·ä½“è¿½åŠ å­—ç¬¦ä¸²æ—¶ï¼Œå…ˆä¼šæ ¹æ®è¦æ’å…¥å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå¯¹åŸæ¥çš„å­—ç¬¦å®¹å™¨è¿›è¡Œæ‰©å®¹ï¼Œç„¶åå·§å¦™çš„é€šè¿‡ String çš„ getChars æ–¹æ³•è¿›è¡Œæ•°æ®æ‹¼æ¥ã€è¿½åŠ ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">AbstractStringBuilder</span> <span class="nf">append</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">str</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
    <span class="k">return</span> <span class="nf">appendNull</span><span class="o">();</span>
  <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
  <span class="c1">// æ‰©å®¹</span>
  <span class="n">ensureCapacityInternal</span><span class="o">(</span><span class="n">count</span> <span class="o">+</span> <span class="n">len</span><span class="o">);</span>
  <span class="c1">// è¿½åŠ  str åˆ°å­—ç¬¦æ•°ç»„å®¹å™¨ä¸­ï¼Œè¿™é‡Œä¼šæŠŠ str è¿½åŠ åˆ° value æ•°ç»„ä¸­ï¼Œcount åŸæ¥å­—ç¬¦çš„æ•°é‡ï¼Œåœ¨å‚æ•°ä¸­æ˜¯åç§»çš„å€¼ï¼Œ</span>
  <span class="n">str</span><span class="o">.</span><span class="na">getChars</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">len</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">count</span><span class="o">);</span>
  <span class="c1">// è¿½åŠ å®Œæˆåï¼ŒåŒæ­¥ä¸€ä¸‹ count çš„å€¼</span>
  <span class="n">count</span> <span class="o">+=</span> <span class="n">len</span><span class="o">;</span>
  <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>getChars çš„å…·ä½“å®ç°è·Ÿ System çš„ arrayCopy ä¸€æ ·ï¼Œéƒ½æ˜¯ native çš„å®ç°ã€‚</p>

<h3 id="tostring">toString()</h3>

<p>ä¸è®ºä½¿ç”¨ StringBuffer è¿˜æ˜¯ StringBuilderï¼Œåœ¨æ„é€ ã€è¿½åŠ å®Œæˆåï¼Œè¦ä½¿ç”¨å­—ç¬¦ä¸²å°±å¿…é¡»è°ƒç”¨ toString æ–¹æ³•ï¼Œè·Ÿå…¶ä»–æ–¹æ³•çš„è°ƒç”¨ä¸ä¸€æ ·ã€‚å®ƒä»¬çš„çˆ¶ç±»å¹¶æ²¡æœ‰æä¾›ç»Ÿä¸€çš„å®ç°ã€‚</p>

<p>StringBuffer è‡ªå·±åšäº†ä¼˜åŒ–ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦æ•°ç»„ toStringCacheï¼Œåœ¨è°ƒç”¨ toString æ—¶ï¼Œå¦‚æœ toStringCache å·²ç»æœ‰å€¼ï¼Œå°±ç®€å•åŒ…è£…è¿”å›ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kd">synchronized</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">toStringCache</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">toStringCache</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOfRange</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">count</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">toStringCache</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">count</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>toStringCache ä¼šåœ¨ StringBuilder è¢«ä¿®æ”¹æ—¶è¢«ç½®ä¸º nullã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * A cache of the last value returned by toString. Cleared
 * whenever the StringBuffer is modified.
 */</span>
<span class="kd">private</span> <span class="kd">transient</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">toStringCache</span><span class="o">;</span>
</code></pre></div></div>

<p>StringBuilder çš„ toString å®ç°æ²¡æœ‰ç”¨åˆ°ç¼“å­˜æœºåˆ¶ï¼Œç›´æ¥ç”¨ StringFactory æä¾›çš„å·¥å…·æ–¹æ³•æŠŠå­—ç¬¦æ•°ç»„è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">""</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// ä¹Ÿæ˜¯ä¸€ä¸ª native å®ç°ï¼Œå®é™…ä¸Šå­—ç¬¦ä¸²çš„å¾ˆå¤šæ“ä½œéƒ½æ˜¯é€šè¿‡ native æ“ä½œå®Œæˆ</span>
  <span class="k">return</span> <span class="nc">StringFactory</span><span class="o">.</span><span class="na">newStringFromChars</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">count</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="string-åŠ æ“ä½œ">String åŠ æ“ä½œ</h2>

<p>å¼€å‘ä¸­å¦‚æœå­—ç¬¦ä¸²éœ€è¦è¿½åŠ å­—ç¬¦ä¸²ï¼Œç»å¸¸è¿™æ ·æ“ä½œ</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">content</span> <span class="o">=</span> <span class="s">"hello"</span><span class="o">;</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">content</span><span class="o">+</span><span class="s">" world"</span><span class="o">);</span>
</code></pre></div></div>

<p><del>è¿™é‡Œç»™è¯¥å­—ç¬¦ä¸²æ·»åŠ ä¸Š world æ—¶ï¼Œä¹Ÿå°±æ˜¯ String åœ¨æ‰§è¡ŒåŠ æ“ä½œæ—¶ï¼Œé¦–å…ˆä¼šå…ˆå¼€è¾Ÿç©ºé—´å­˜å‚¨ world è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åå†å¼€è¾Ÿç©ºé—´å°†ä¸¤ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªç®€å•çš„æ‹¼æ¥å·¥ä½œï¼ŒStringéœ€è¦å¼€è¾Ÿä¸‰å—ç©ºé—´æ¥å®Œæˆã€‚</del></p>

<blockquote>
  <p>æ³¨æ„ï¼šä»¥ä¸Šæ˜¯ä¸å‡†ç¡®çš„è§£é‡Šã€‚</p>
</blockquote>

<p>å®é™…ä¸Šä¸Šé¢è¯´å¯¹äº†ä¸€åŠï¼Œåœ¨ Java 1.8 ä¹‹å‰ï¼Œç¡®å®æ˜¯ä¸Šé¢æ‰€è¯´çš„é‚£æ ·ï¼Œä½†æ˜¯ 1.8 ä¹‹åä¼˜åŒ–äº† String çš„ åŠ æ“ä½œï¼Œåœ¨ç¼–è¯‘è¿è¡Œæ—¶ä¼šæ ¹æ®ä¸åŒæƒ…å†µä½¿ç”¨ StringBuilder æˆ–è€… StringBuffer Â è¿›è¡Œå†…éƒ¨ä¼˜åŒ–æ›¿æ¢ã€‚è¿™ä¸€ç‚¹åœ¨ String çš„æºç æ³¨é‡Šä¸­æœ‰è¯´æ˜ï¼š</p>

<p><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/159409/1572992596799-b72abd81-921f-47ff-840b-51e957da5572.jpeg#align=left&amp;display=inline&amp;height=109&amp;originHeight=109&amp;originWidth=587&amp;size=0&amp;status=done&amp;width=587" alt="" /></p>

<p>æ‰€ä»¥è¿™æ ·è¯´æ¥ï¼Œå¹³æ—¶ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼Œå®Œå…¨å¯ä»¥ç”¨ + å·è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥äº†ï¼Œæ²¡å¿…è¦ç”¨ StringBuilderã€‚è¿™ä¹Ÿæ˜¯æŠ€æœ¯å‘å±•çš„è¶‹åŠ¿æ‰€åœ¨ï¼Œå¥½ç”¨ã€ç®€å•æ°¸è¿œæ˜¯ä¸»æµã€‚</p>

<h2 id="æ€»ç»“">æ€»ç»“</h2>

<p>è¿™ç¯‡æ–‡ç« ä»ä¸‰è€…çš„åŒºåˆ«è¯´èµ·ï¼Œæ˜¯ä¸€ä¸ªç»å¸¸é¢è¯•æ—¶è¢«é—®åˆ°çš„é—®é¢˜ï¼Œåé¢ä¸»è¦åˆ†æäº† StringBuilder ä»¥åŠ StringBuffer éƒ¨åˆ†æºç ï¼Œç®—æ˜¯å­¦ä¹ ç ”ç©¶ã€‚</p>

<p>è¯´é“æœ€ç»ˆçš„æ€§èƒ½ï¼Œç»è¿‡ä¼˜åŒ–çš„ String å…¶å®è·Ÿ StringBuilder ä¸€è‡´ï¼Œæ€§èƒ½éƒ½ä¸é”™ï¼Œæ‰€ä»¥å¼€å‘è¿‡ç¨‹ä¸­æ²¡å¿…è¦çº ç»“ç”¨ String è¿˜æ˜¯ StringBuilderï¼Œä½†æ˜¯å‰ææ˜¯ä½ è¦çŸ¥é“ String è¢«ä¼˜åŒ–è¿™ä¸ªäº‹ã€‚</p>

<h2 id="å…³äºä½œè€…">å…³äºä½œè€…</h2>

<p>å’•å’šï¼ŒAndroid å·¥ç¨‹å¸ˆï¼Œä¸ªäººåšå®¢ <a href="gudong.site">gudong.site</a>ï¼Œå…¬ä¼—å·ï¼šå’•å–±å’•å’š</p>
:ET