I"òG<p>æœ€è¿‘å®Œæˆäº†ä¸€ä¸ªå¹²è´§å®¢æˆ·ç«¯ <a href="https://github.com/maoruibin/GankDaily">GankDaily</a> ï¼Œ
ä¸€ä¸ªåŸºäº<a href="http://gank.io">å¹²è´§é›†ä¸­è¥</a>çš„æ‰‹æœºå®¢æˆ·ç«¯ï¼Œæ•´ä¸ªå®¢æˆ·ç«¯å€Ÿé‰´ drakeet çš„<a href="https://github.com/drakeet/Meizhi">å¦¹çº¸</a>åº”ç”¨ã€‚ä½†æ˜¯åœ¨åŸé¡¹ç›®çš„åŸºç¡€ä¸Šï¼Œ
è‡ªå·±ä½¿ç”¨ MVP æ¨¡å¼å¯¹é¡¹ç›®è¿›è¡Œé‡æ„ï¼Œè®©ä»£ç ç»“æ„è¿›ä¸€æ­¥è§£è€¦ï¼Œä½¿ä¸šåŠ¡é€»è¾‘å’Œè§†å›¾è¡¨ç°å±‚ç›¸åˆ†ç¦»ï¼Œä»è€Œè®©ä»£ç é€»è¾‘å˜å¾—æ›´ç®€å•ï¼Œ
ä»¥ä¸‹å°±æ•´ç†äº†è‡ªå·±åœ¨é‡æ„é¡¹ç›®è¿‡ç¨‹ä¸­å¯¹ MVP è¿™ç§æ¨¡å¼çš„ç†è§£ä»¥åŠé¡¹ç›®ä¸­å¦‚ä½•å®æ–½ MVP çš„æ¨¡å¼ã€‚</p>

<h3 id="å…³äºmvp">å…³äºMVP</h3>

<p>MVP æ˜¯ Model-Presenter-Viewçš„ç¼©å†™ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯æ¨¡å‹-æ§åˆ¶å™¨-è§†å›¾ï¼Œæ˜¯ä¸€ç§æµè¡Œçš„å¼€å‘æ¶æ„æ¨¡å¼ã€‚ä»–ä¸»å¼ è®© Presenter æ§åˆ¶æ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘ï¼Œ
è®© View å±‚åšå…·ä½“çš„ç•Œé¢æ›´æ–°ï¼ŒModel ä¸“é—¨è´Ÿè´£æ•°æ®è·å–ç­‰æ“ä½œã€‚</p>

<p>é€šå¸¸æˆ‘ä»¬å†™æƒ¯äº† Android é¡¹ç›®ï¼Œä¸€èˆ¬ä¸€ä¸ª Activity ä¸­å¯èƒ½å¯¹åº”å¾ˆå¤šæ•°æ®äº¤äº’ï¼Œæ¯”å¦‚è¿™ä¸ªå¹²è´§å®¢æˆ·ç«¯é¦–é¡µï¼Œåªè¦ä¸€è¿›å…¥é¦–é¡µï¼Œå®ƒéœ€è¦è·å–å½“å¤©çš„å¹²è´§æ•°æ®ã€‚
æ»‘åŠ¨åˆ°åº•éƒ¨éœ€è¦åŠ è½½æ›´å¤šæ•°æ®ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯èƒ½æœ‰ä¸€äº›å…¶ä»–çš„ä¸šåŠ¡é€»è¾‘æ¯”å¦‚æ£€æŸ¥ç‰ˆæœ¬ä¿¡æ¯ç­‰ã€‚ä¸€èˆ¬çš„ï¼Œè¿™äº›æ“ä½œå…¨éƒ¨æ”¾åœ¨ Activity ä¸­æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼Œ
è¿™æ ·åšä¸€ç‚¹ä¸å¦¨ç¢ä½ å®Œæˆæ‰€æœ‰çš„åŠŸèƒ½ã€‚è€Œä¸”å¸‚é¢ä¸Šç¡®å®æœ‰ä¸å°‘é¡¹ç›®çœŸæ˜¯è¿™ä¹ˆåšçš„ï¼Œæœ€è¿‘è·Ÿä¸€äº›æœ‹å‹èŠå¤©ï¼Œä¹Ÿè¯´è¿‡ä»–è´Ÿè´£çš„é¡¹ç›®å°±æ˜¯è¿™ä¹ˆå¹²çš„ï¼Œä¸€ä¸ª Activity 6000
å¤šè¡Œä»£ç ï¼Œç®€ç›´æ˜¯ç¾éš¾~</p>

<p>ä¸è¿‡è‡ªå·±ä¸€å¼€å§‹å†™ä»£ç æ—¶ï¼Œç¡®å®ä¹Ÿæ˜¯è¿™æ ·å†™çš„ï¼ˆå›§~ï¼‰ï¼Œè®°å¾—æ›¾ç»å†™è¿‡ä¸€ä¸ªè¯¦æƒ…å±•ç¤ºé¡µï¼Œä»£ç å†™äº†2000å¤šè¡Œï¼Œå½“æ—¶è§‰å¾—è¿˜æŒºè‡ªè±ª(å‘µå‘µ~)ï¼Œä¸€ä¸ªç±»2000å¤šè¡Œå‘¢ï¼Œç°åœ¨æƒ³æƒ³ä¹Ÿæ˜¯è§‰å¾—
Too Young Too Simple .</p>

<p>æŒ‰ç…§ MVP çš„å®šä¹‰ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠæ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘æ“ä½œéƒ½å†™åœ¨ Presenter å±‚ï¼Œè€Œ View å±‚(View å±‚ä¸€èˆ¬ç”± Activityã€Fragmentå……å½“)ä»–ä»¬ä¸»è¦åšä¸€äº›æ›´æ–°ç•Œé¢ã€
å‘ Presenter å±‚å‘é€è¯·æ±‚çš„æ“ä½œã€‚Model å±‚åˆ™ä¸»è¦è´Ÿè´£å…·ä½“çš„æ•°æ®è·å–æ“ä½œã€‚ä»–ä»¬çš„å…·ä½“å…³ç³»å¯ä»¥çœ‹ä¸‹é¢è¿™å¼ å›¾ã€‚</p>

<p><img src="/assets/gank_mvp_1.jpg" alt="mvp" title="mvp" /></p>

<p>ç”±å›¾å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°ï¼ŒPresenter å¤„åœ¨ä¸€ä¸ªä¸­å¿ƒä½ç½®ï¼ŒView å±‚å‘ Presenter å‘é€è¯·æ±‚ï¼ŒPresenter è‡ªå·±æ¥å—è¯·æ±‚ï¼Œä½†æ˜¯è‡ªå·±ä¸å…·ä½“æ‰§è¡Œè¯·æ±‚ï¼Œè€Œæ˜¯å°†
å…·ä½“çš„äº‹æƒ…äº¤ç»™ Model å»å¤„ç†ï¼Œ åˆ©ç”¨ Model å±‚è¯·æ±‚å®Œæ¯•åï¼ŒPresenter å†æŠŠå…·ä½“çš„ç»“æœé€šè¿‡æŸç§æ–¹å¼å“åº”åœ¨ View å±‚ã€‚</p>

<h4 id="ä¸€ä¸ªä¾‹å­">ä¸€ä¸ªä¾‹å­</h4>

<p>ä¸Šé¢è¯´çš„æœ‰ç‚¹æŠ½è±¡ï¼Œå…¶å®è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç†è§£çš„æ›´åŠ å½¢è±¡ä¸€ç‚¹ã€‚æ‰“ä¸ªæ¯”å–»ï¼ŒæŠŠ P ç†è§£ä¸ºè‡ªå·±çš„è„‘è¢‹ï¼ŒV ç†è§£ä¸ºå³æ‰‹ M ç†è§£ä¸º å·¦æ‰‹,ç„¶åä½ å°±ç«™åœ¨é‚£é‡Œï¼Œ
å‡è®¾å·¦å³æ‰‹æ˜¯ä¸èƒ½ç›´æ¥æ²Ÿé€šï¼Œå·¦å³æ‰‹åˆ†åˆ«é€šè¿‡å·¦èƒ³è†Šå’Œå³èƒ³è†Šä¸è„‘è¢‹è”ç³»ã€‚</p>

<p>ç°åœ¨ V(å³æ‰‹)éœ€è¦100å—é’±è¿›è¡Œæ¶ˆè´¹ï¼Œä½†æ˜¯é’±å´å­˜å‚¨åœ¨ M(å·¦æ‰‹)é‡Œï¼Œè¿™æ—¶ V(å³æ‰‹)é€šè¿‡å³èƒ³è†Šå‘Šè¯‰P(è„‘è¢‹)ï¼Œâ€è„‘è¢‹ï¼Œæˆ‘éœ€è¦100å—é’±ï¼Œå¿«ç»™æˆ‘ã€‚â€ï¼Œè„‘è¢‹
å¾—åˆ°è¿™ä¸ªå‘½ä»¤åï¼Œå› ä¸ºè‡ªå·±ä¸ç®¡é’±ï¼Œæ‰€ä»¥åªå¾—å»è¯·æ±‚ M (å·¦æ‰‹),Pï¼ˆè„‘è¢‹ï¼‰é€šè¿‡å·¦èƒ³è†Šå‘Šè¯‰ M(å·¦æ‰‹),è¯´è‡ªå·±éœ€è¦100å—é’±ï¼Œ
M(å·¦æ‰‹)çŸ¥é“ P éœ€è¦é’±ï¼Œæ‰€ä»¥å°±æ…·æ…¨çš„ç»™é’±,è°å«ä»–æ˜¯è€å¤§å‘¢ï¼Œæ­¤æ—¶ P é¡ºåˆ©æ‹¿åˆ°é’±åï¼Œè‡ªå·±å¯¹é’±ç¨å¾®åšä¸€äº›éªŒè¯æ“ä½œï¼Œå‘ç°é’±æ²¡é—®é¢˜ï¼Œç„¶åå°±æŠŠé’±ç»™äº† Vï¼ˆå³æ‰‹ï¼‰ï¼Œ
æ­¤æ—¶ä¸ºäº†å®‰å…¨èµ·è§ï¼ŒP (è„‘è¢‹)éœ€è¦è°ƒç”¨ä¸€ä¸‹ V(å³æ‰‹) æä¾›çš„ä¸€ä¸ªæ¡æ‹³æ–¹æ³•ï¼Œä»¥ä¾¿åŠæ—¶çš„æ”¥ä½é’±ï¼Œé˜²æ­¢é—å¤±ï¼Œå‡è®¾è¿™ä¸ªæ–¹æ³•å°±å« holdå§ï¼ŒP è°ƒç”¨ V(å³æ‰‹)çš„holdæ–¹æ³•
åï¼Œå³æ‰‹åœ¨æ‹¿åˆ°é’±çš„åŒæ—¶ï¼Œå°±ç«‹å³æ”¥ç´§äº†é’±ï¼Œè¿™æ ·é’±å°±ä¸å®¹æ˜“è¢«åˆ«äººæ‹¿èµ°äº†ã€‚</p>

<p>åˆ°è¿™é‡Œï¼Œæ•´ä¸ªä¸€æ¬¡å®Œæ•´çš„æ•°æ®äº¤äº’(å·¦æ‰‹å–é’±)ã€ç•Œé¢æ›´æ–°(å³æ‰‹æ”¥é’±)è¿‡ç¨‹å°±ç»“æŸäº†ï¼ŒM è‡ªå§‹è‡³ç»ˆä¹Ÿæ²¡æœ‰è·Ÿ V å‘ç”Ÿä»»ä½•ç›´æ¥å…³ç³»ï¼Œå®ƒç”šè‡³ä¸çŸ¥é“ V çš„å­˜åœ¨ã€‚P åˆ™åœ¨
æœ€ä¸­å¤®çš„ä½ç½®è´Ÿè´£åè°ƒæ•°æ®ã€æ“ä½œViewã€‚ä»–ä»å·¦æ‰‹æ‹¿é’±ï¼Œç„¶åäº¤ç»™å³æ‰‹ã€‚å½“ç„¶è¿˜å¯ä»¥æ›´å¤šå¤æ‚çš„æ“ä½œï¼Œä½†æ˜¯æ•´ä¸ª MVP çš„å¤§ä½“ç»“æ„å°±æ˜¯è¿™æ ·ã€‚</p>

<p>å¦‚æœè¿™ä¸ªæ¯”å–»è§‰å¾—ä¸æ¸…æ¥šï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥å»çœ‹é¸¿æ´‹ä¹‹å‰å†™çš„ä¸€ç¯‡åšå®¢ï¼Œç”¨ä¸€ä¸ªç™»å½•ç¤ºä¾‹è®²è§£ MVP ï¼Œè®²çš„å¾ˆæ¸…æ¥šã€‚</p>

<p><a href="http://blog.csdn.net/lmj623565791/article/details/46596109">æµ…è°ˆ MVP in Android</a></p>

<h4 id="å‡ ä¸ªç–‘é—®">å‡ ä¸ªç–‘é—®</h4>

<p>åˆ°è¿™é‡Œå¯èƒ½ä¼šæœ‰å‡ ä¸ªç–‘é—®ï¼Œ</p>

<ul>
  <li>åœ¨ View(Activityã€Fragment)å±‚ä¸­æ€ä¹ˆå»è°ƒç”¨ Presenter ä¸­çš„æ–¹æ³•ï¼Ÿ</li>
</ul>

<p>è¿™ä¸ªç®€å•ï¼Œåœ¨Viewåˆå§‹åŒ–æ—¶ï¼Œnew ä¸€ä¸ª Presenter å®ä¾‹ä¸å°±å¯¹äº†å—ï¼Œç¡®å®å¯è¡Œï¼Œæˆ‘ç›®å‰ä¹Ÿæ˜¯è¿™æ ·åšçš„ã€‚</p>

<ul>
  <li>Presenter æ€ä¹ˆå»æ§åˆ¶ View ä¸­çš„ç•Œé¢é€»è¾‘ï¼Ÿå…·ä½“ç‚¹å°±æ˜¯ï¼Œä¸Šé¢çš„å¤´éƒ¨æœ€åæ€ä¹ˆè°ƒç”¨å³æ‰‹çš„ hold() æ–¹æ³•ï¼Ÿ</li>
</ul>

<p>è¿™é‡Œéœ€è¦é€šè¿‡è®© View å±‚é€šè¿‡å®ç°ç‰¹å®š View æ¥å£ï¼Œæ¯ä¸€ä¸ª View ç±»ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ª Activity å¯¹åº”å®ç°ä¸€ä¸ªæŠ½è±¡çš„æ¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å†™æ¯ä¸ª Activity æ—¶ï¼Œé¦–å…ˆæŠŠå…·ä½“çš„
 View æ“ä½œåŠ¨ä½œæå–ä¸ºä¸€ä¸ªæ¥å£ï¼Œè®© View å®ç°ï¼Œè®©åæƒ³åŠæ³•æŠŠè¿™ä¸ªæ¥å£çš„å®ä¾‹ä¼ é€’åˆ° Presenter å®ä¾‹ä¸­å³å¯ï¼Œè¿™é‡Œå¯èƒ½ç¨å¾®æœ‰ç‚¹æ¨¡ç³Šï¼Œä½†æ˜¯é€šè¿‡
 ä¸‹é¢å…·ä½“çš„ä»£ç ï¼Œä½ å¯èƒ½å°±æ›´æ¸…æ¥šäº†ã€‚</p>

<h2 id="mvp-å®è·µ">MVP å®è·µ</h2>

<p>å¯ä»¥å…ˆçœ‹çœ‹ä¸»ç•Œé¢ã€‚å¦‚ä¸‹å›¾ï¼Œ</p>

<p><img src="/assets/gank_mvp_introduce.png" alt="mvp" title="mvp" /></p>

<p>ä¸»ç•Œé¢ MainActivity æ˜¾ç¤ºçš„æ˜¯å½“å¤©çš„å¹²è´§ä¿¡æ¯ï¼Œä¸‹æ‹‰å¯åˆ·æ–°ï¼Œæ»‘åŠ¨åˆ°åº•éƒ¨å¯ä»¥åŠ è½½æ›´å¤šï¼Œè¿›å…¥ä¸»ç•Œé¢è¿˜éœ€è¦å»æ£€æŸ¥ç‰ˆæœ¬ä¿¡æ¯ï¼Œ
å¦‚æœå‘ç°æ˜¯æ–°ç‰ˆæœ¬ï¼Œå¥½éœ€è¦å¼¹å‡ºä¸€ä¸ª Dialog æ˜¾ç¤ºæ›´æ–°æ—¥å¿—ã€‚å¤§æ¦‚çš„ä¸šåŠ¡ä¹Ÿå°±è¿™äº›ï¼Œç„¶åæˆ‘ä»¬æŠŠæ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘éƒ½å†™åœ¨ MainPresenter ä¸­ï¼Œ
ä»£ç å¦‚ä¸‹ï¼Œéƒ¨åˆ†ä»£ç çœç•¥ï¼Œå¦‚æœæƒ³çœ‹å…¨éƒ¨ä»£ç ï¼Œç‚¹å‡»<a href="https://github.com/maoruibin/GankDaily/blob/master/app/src/main/java/com/gudong/gankio/presenter/MainPresenter.java#L32-32">æºç </a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    public void getData(final Date date) {
        mCurrentDate = date;
        mGuDong.getGankData(year, month, day)
                .observeOn(AndroidSchedulers.mainThread())
                .subscribe(new Subscriber&lt;List&lt;Gank&gt;&gt;() {
                    @Override
                    public void onCompleted() {
                        // after get data complete, need put off time one day
                        mCurrentDate = new Date(date.getTime()-DAY_OF_MILLISECOND);
                    }

                    @Override
                    public void onError(Throwable e) {
                    }

                    @Override
                    public void onNext(List&lt;Gank&gt; list) {
                        // some day the data will be return empty like sunday, so we need get after day data
                        if (list.isEmpty()) {
                            getData(new Date(date.getTime()-DAY_OF_MILLISECOND));
                        } else {
                            mCountOfGetMoreDataEmpty = 0;
                            mView.fillData(list);
                        }
                        mView.getDataFinish();
                    }
                });
    }

    public void checkAutoUpdateByUmeng() {
        if(mContext.getIntent().getSerializableExtra("BUNDLE_GANK") == null){
            UmengUpdateAgent.setUpdateCheckConfig(BuildConfig.DEBUG);
            //check update even in 2g/3g/4g condition
            UmengUpdateAgent.setUpdateOnlyWifi(false);
            UmengUpdateAgent.update(mContext);
        }
    }

    //check version info ,if the version info has changed,we need pop a dialog to show change log info
    public void checkVersionInfo() {
        String currentVersion = AndroidUtils.getAppVersion(mContext);
        String localVersionName = AndroidUtils.getLocalVersion(mContext);
        if (!localVersionName.equals(currentVersion)) {
            mView.showChangeLogInfo("changelog.html");
            AndroidUtils.setCurrentVersion(mContext, currentVersion);
        }
    }


    /**
     * @return
     */
    public boolean shouldRefillData(){
        return !hasLoadMoreData;
    }
</code></pre></div></div>

<p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œè·å–æ•°æ®çš„æ–¹æ³• getData(Date date)æ¥å—ä¸€ä¸ª date å‚æ•°ï¼Œè°ƒç”¨è€… MainActivity åªéœ€è¦åœ¨æŸä¸ªåœ°æ–¹è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¼ é€’å½“å‰çš„
æ—¥æœŸï¼Œå°±å¯ä»¥è·å–åˆ°å½“å‰æ‰€æœ‰çš„å¹²è´§æ•°æ®ã€‚åˆ°è¿™ï¼ŒView è¯·æ±‚ Presenter å®Œæˆã€‚ä¸‹é¢å…·ä½“æ‰§è¡Œæ•°æ®è¯·æ±‚å°±æ˜¯å¦å¤–çš„æ¨¡å—äº†ã€‚</p>

<p>è¿™é‡Œä»å…·ä½“ä»£ç çœ‹ï¼Œå¯ä»¥å‘ç°ï¼Œæ•°æ®è¯·æ±‚æ˜¯é€šè¿‡ Rxjava + Retrofit å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  public void getData(final Date date) {
        mCurrentDate = date;
        Calendar calendar = Calendar.getInstance();
        calendar.setTime(date);
        int year = calendar.get(Calendar.YEAR);
        int month = calendar.get(Calendar.MONTH)+1;
        int day = calendar.get(Calendar.DAY_OF_MONTH);
        //è·å–åˆ° å¹´ æœˆ æ—¥ ä¸‰ä¸ªå‚æ•° ï¼Œå‡†å¤‡ä¼ é€’ç»™å…·ä½“çš„æ–¹æ³•ã€‚
        mGuDong.getGankData(year, month, day)
                .observeOn(AndroidSchedulers.mainThread())
                .map(new Func1&lt;GankData, GankData.Result&gt;() {
                    @Override
                    public GankData.Result call(GankData gankData) {
                        return gankData.results;
                    }
                })
                .map(new Func1&lt;GankData.Result, List&lt;Gank&gt;&gt;() {
                    @Override
                    public List&lt;Gank&gt; call(GankData.Result result) {
                        return addAllResults(result);
                    }
                })
                .subscribe(new Subscriber&lt;List&lt;Gank&gt;&gt;() {
                    @Override
                    public void onCompleted() {
                        // è·å–æ•°æ®å®Œæ¯•ï¼Œå°†æ—¥æœŸæ¨è¿Ÿåˆ°ä¸‹ä¸€å¤© ä¸ºè·å–æ›´å¤šæ•°æ®åšå‡†å¤‡
                        mCurrentDate = new Date(date.getTime()-DAY_OF_MILLISECOND);
                    }

                    @Override
                    public void onError(Throwable e) {
                    }

                    @Override
                    public void onNext(List&lt;Gank&gt; list) {
                        // å¦‚æœæœ‰ä¸€å¤©æ•°æ®ä¸ºç©ºï¼Œåˆ™ç»§ç»­è·å–ä¸‹ä¸€å¤©çš„æ•°æ®
                        if (list.isEmpty()) {
                            getData(new Date(date.getTime()-DAY_OF_MILLISECOND));
                        } else {
                            //æ›´æ–°ä¸»ç•Œé¢æ•°æ®
                            mCountOfGetMoreDataEmpty = 0;
                            mView.fillData(list);
                        }
                        mView.getDataFinish();
                    }
                });
    }
</code></pre></div></div>

<p>åœ¨ onNext æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è·å–åˆ°äº†æœ€ç»ˆçš„æ•°æ®ï¼Œæ­¤æ—¶ Presenter éœ€è¦é€šçŸ¥ View æ›´æ–°ç•Œé¢ï¼Œæ‰€ä»¥è¿™é‡Œæœ‰äº†å¦‚ä¸‹çš„è°ƒç”¨</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Override
public void onNext(List&lt;Gank&gt; list) {
    // å¦‚æœæœ‰ä¸€å¤©æ•°æ®ä¸ºç©ºï¼Œåˆ™ç»§ç»­è·å–ä¸‹ä¸€å¤©çš„æ•°æ®
    if (list.isEmpty()) {
        getData(new Date(date.getTime()-DAY_OF_MILLISECOND));
    } else {
        //æ›´æ–°ä¸»ç•Œé¢æ•°æ®
        mCountOfGetMoreDataEmpty = 0;
        mView.fillData(list);
    }
    mView.getDataFinish();
}
</code></pre></div></div>

<p>è¿™é‡Œé€šè¿‡ mView è¿™ä¸ªå®ä¾‹ çš„fillData æ–¹æ³•å»æ›´æ–°ä¸»ç•Œé¢ã€‚é‚£ä¹ˆ mView æ˜¯ä¸€ä¸ªä»€ä¹ˆå˜é‡å‘¢ï¼Œæœ€ç»ˆä½ ä¼šå‘ç°ï¼Œä»–æ˜¯ä¸€ä¸ª IMainView æ¥å£çš„å®ä¾‹ï¼Œå¯ä»¥çœ‹çœ‹
è¿™ä¸ªæ¥å£æ˜¯æ€ä¹ˆå®šä¹‰çš„ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public interface IMainView&lt;T extends Soul&gt;  extends ISwipeRefreshView {
    /**
     * load data successfully
     * @param data
     */
    void fillData(List&lt;T&gt; data);

    /**
     * append data to history list(load more)
     * @param data
     */
    void appendMoreDataToView(List&lt;T&gt; data);

    /**
     * no more data for show and this condition is hard to appear,it need you scroll main view long time
     * I think it has no body do it like this ,even thoughï¼ŒI deal this condition also, In case someone does it.
     */
    void hasNoMoreData();

    /**
     * show change log info in a dialog
     * @param assetFileName the name of local html file like "changelog.html"
     */
    void showChangeLogInfo(String assetFileName);
}
</code></pre></div></div>

<p>å‘ç°è¿™ä¸ªæ¥å£ä¸­ç¡®å®å­˜åœ¨ä¸€ä¸ª fillData æ–¹æ³•ï¼Œæ‰€ä»¥ä¸Šé¢ä½¿ç”¨ mView è°ƒç”¨ fillData æ˜¯å¯è¡Œçš„ã€‚</p>

<p>é‚£å¦‚æœ MainPresenter éƒ½å¯ä»¥è°ƒç”¨ IMainView çš„ fillData()æ–¹æ³•æ¥æ›´æ–° MainActivity, å“ªMainActivity å°±å’Œ IMainView æœ‰å¿…ç„¶çš„å…³ç³»ï¼Œ
ä¸€ä¸ªæ˜¯ç±»ä¸€ä¸ªæ˜¯æ¥å£ï¼Œè¿˜èƒ½ä¼šæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Œè¿™é‡Œ MainActivity å®ç°äº† IMainView è¿™ä¸ªæ¥å£ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class MainActivity extends BaseSwipeRefreshActivity&lt;MainPresenter&gt; implements IMainView&lt;Gank&gt;,MainListAdapter.IClickMainItem {
</code></pre></div></div>

<p>æ—¢ç„¶ MainActivity å®ç°äº† IMainView æ¥å£ï¼Œé‚£ä»–å¿…ç„¶å®ç°å¯¹åº”çš„æ–¹æ³• fillData() ,å¦‚ä¸‹æ‰€ç¤º</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Override
public void fillData(List&lt;Gank&gt; data) {
    mAdapter.updateWithClear(data);
}
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå®ç°å¾ˆç®€å•ï¼Œå°±æ˜¯æ›´æ–°ä¸€ä¸‹ Adapter å°± OKï¼ŒActivity ä¸­å†ä¹Ÿçœ‹ä¸åˆ°ä»»åŠ¡è·å–æ•°æ®çš„ä»£ç ã€‚</p>

<p>åˆ°è¿™é‡Œï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ MainPresenter æ˜¯åœ¨ MainActivity çš„ä»€ä¹ˆåœ°æ–¹å®ä¾‹åŒ–çš„ã€‚è¿™é‡Œå› ä¸ºæ¯ä¸ª Activity éƒ½æ˜¯ç»§æ‰¿è‡ª BaseActivity ï¼Œè€Œä¸”æ¯ä¸ª
Activity å¿…é¡»æœ‰ä¸€ä¸ª Presenter ,æ‰€ä»¥æˆ‘åœ¨ BaseActivity ä¸­å·²ç»äº‹å…ˆå®šä¹‰äº†ä¸€ä¸ª BasePresenter çš„å®ä¾‹ mPresenterï¼ŒåŒæ—¶ç»™ BaseActivity è®¾ç½®ä¸€ä¸ª
æŠ½è±¡æ–¹æ³• initPresenter()ã€‚è¿™ä¸ªæ–¹æ³•å°†ä¼šåœ¨BaseActivity onCreate æ—¶æ‰§è¡Œåˆ°ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤º</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public abstract class BaseActivity&lt;P extends BasePresenter&gt; extends AppCompatActivity {
    @Bind(R.id.toolbar)
    protected Toolbar mToolbar;
    /**
     * the presenter of this Activity
     */
    protected P mPresenter;

    /**
     * TODO use Dagger2 instance Presenter
     */
    protected abstract void initPresenter();

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(getLayout());
        ButterKnife.bind(this);
        initPresenter();
        checkPresenterIsNull();
        initToolBar();
    }

    private void checkPresenterIsNull(){
       if(mPresenter == null){
           throw new IllegalStateException("please init mPresenter in initPresenter() method ");
       }
     }
}
</code></pre></div></div>

<p>è®¾ç½®æŠ½è±¡æ–¹æ³•çš„ç›®çš„å°±æ˜¯å¼ºåˆ¶æ¯ä¸ªç»§æ‰¿è‡ª BaseActivity çš„Activityç±» éƒ½å¿…é¡»å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶å®ä¾‹åŒ– BasePresenterï¼›</p>

<p>å¦‚æœä¸å®ä¾‹åŒ– mPresenterï¼Œå¯ä»¥çœ‹åˆ°åœ¨ onCreate ä¸­å¯¹ mPresenter æ˜¯å¦å·²ç»è®¾ç½®å€¼åšäº† checkPresenterIsNull() å¤„ç†,åªè¦å‘ç° mPresenter ä¸º null
è¿™é‡Œå°±ä¼šæŠ¥é”™ã€‚</p>

<p>MainActivity ç»§æ‰¿è‡ª BaseActivity ï¼Œæ‰€ä»¥å®ƒå®ç°äº† initPresenter() æ–¹æ³•ã€‚</p>

<p>MainActivityä¸­ initPresenter</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    @Override
    protected void initPresenter() {
        mPresenter = new MainPresenter(this, this);
    }
</code></pre></div></div>

<p>è¿™é‡Œå¯ä»¥åˆ° MainPresenter çš„æ„é€ å‡½æ•°ä¼ é€’äº†ä¸¤ä¸ªå‚æ•°ã€‚å¯ä»¥æŸ¥çœ‹ MainPresenter çš„æ„é€ æ–¹æ³•</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> public MainPresenter(Activity context, IMainView view) {
        super(context, view);
 }
</code></pre></div></div>

<p>å®ƒç›´æ¥è°ƒç”¨è‡ªå·±çˆ¶ç±» BasePresenter çš„æ„é€ æ–¹æ³•ï¼Œè¿™é‡Œå¯ä»¥çœ‹çœ‹ BasePresenter ç±»ï¼Œå¾ˆç®€å•ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class BasePresenter&lt;GV extends IBaseView&gt; {

    protected GV mView;

    protected Activity mContext;

    public static final GuDong mGuDong = MainFactory.getGuDongInstance();

    public BasePresenter(Activity context, GV view) {
        mContext = context;
        mView = view;
    }
}
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ Activity å’Œ IBaseView çš„å®ä¾‹ï¼ŒIBaseView æ˜¯æ‰€æœ‰æŠ½è±¡ View æ¥å£çš„çˆ¶æ¥å£(ç›®å‰æ˜¯ä¸€ä¸ªç©ºæ¥å£)ï¼Œ
IMainViewç»§æ‰¿è‡ªIBaseViewã€‚</p>

<p>è¿™é‡Œå°±å¯ä»¥çœ‹åˆ° å…¶å®æ¯ä¸ª Presenter ä¸­éƒ½æœ‰ä¸€ä¸ª IBaseView çš„å®ä¾‹ï¼Œåªè¦åœ¨ Activity å®ä¾‹åŒ–äº† Presenter å®ä¾‹ï¼Œé‚£ä¹ˆå¯¹åº”çš„IBaseView
å®ä¾‹å…¶å®ä¹Ÿå·²ç»ä¼ é€’åˆ°äº† Presenter ä¸­ï¼Œè¿™æ ·åªè¦æ˜¯ç•Œé¢æ›´æ–°çš„æ“ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥æ–¹ä¾¿çš„è°ƒç”¨ IBaseView ä¸­çš„æ¥å£äº†ã€‚
å†çœ‹ä¸€ä¸‹ MainPresenter ä¸­ çš„ onNext æ–¹æ³•ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Override
public void onNext(List&lt;Gank&gt; list) {
    // å¦‚æœæœ‰ä¸€å¤©æ•°æ®ä¸ºç©ºï¼Œåˆ™ç»§ç»­è·å–ä¸‹ä¸€å¤©çš„æ•°æ®
    if (list.isEmpty()) {
        getData(new Date(date.getTime()-DAY_OF_MILLISECOND));
    } else {
        //æ›´æ–°ä¸»ç•Œé¢æ•°æ®
        mCountOfGetMoreDataEmpty = 0;
        mView.fillData(list);
    }
    mView.getDataFinish();
}
</code></pre></div></div>

<p>æ­¤æ—¶ mView è°ƒç”¨ fillData()æ–¹æ³•ï¼Œåº”è¯¥å·²ç»æ¸…æ¥šäº†å§ã€‚</p>

<h2 id="æ€»ç»“">æ€»ç»“</h2>

<p>è‡³æ­¤ï¼ŒMVP å¤§æ¦‚å°±è¯´å®Œäº†ï¼Œå¯ä»¥çœ‹çœ‹é¡¹ç›®æ¥å£ï¼Œä¹Ÿè®¸ä¼šçœ‹åˆ°æ›´æ¸…æ¥šä¸€ç‚¹ã€‚</p>

<p><img src="/assets/gank_mvp_3.jpeg" alt="mvp" title="mvp" /></p>

<p>æ­¤å¤–ï¼Œè¿˜ç”¨åˆ°äº†ä¸€äº›æ³›å‹çš„çŸ¥è¯†ç‚¹ï¼Œç”¨æ¥çº¦æŸBaseç±»çš„ç±»å‹ï¼Œå¤§å®¶æœ‰çœ‹ç€ä¸æ˜ç™½çš„åœ°æ–¹ï¼Œå¯ä»¥ç•™è¨€ã€‚</p>
:ET