I"Ø<p>æœ€è¿‘åœ¨å¼€å‘å’•å’šç¿»è¯‘æ—¶ï¼Œåœ¨åå¥½è®¾ç½®çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†ä¸€ä¸ªè«åå…¶å¦™çš„ bugï¼Œåœ¨ A è¿›ç¨‹ä¸­è®¾ç½®åå¥½è®¾ç½®åï¼ŒB è¿›ç¨‹ä¸èƒ½åŠæ—¶è®¿é—®åˆ° A è¿›ç¨‹ä¸­è®¾ç½®çš„æ•°æ®ï¼Œä»Šæ™šç»ˆäºå¾—åˆ°è§£å†³ï¼Œéšå³åšä¸€æ¬¡ç®€å•çš„è®°å½•ã€‚</p>

<h2 id="å’•å’šç¿»è¯‘">å’•å’šç¿»è¯‘</h2>
<p>è¿™é‡Œå…ˆç®€å•ä»‹ç»ä¸‹å’•å’šç¿»è¯‘è¿™ä¸ª Appï¼Œå¦‚åå­—æ‰€è¨€ï¼Œå®ƒä¸»è¦çš„åŠŸèƒ½æ˜¯ç¿»è¯‘ï¼Œä¸è¿‡ç›¸æ¯”å…¶ä»–çš„ç¿»è¯‘è½¯ä»¶ï¼Œä»–çš„ç¿»è¯‘æ•ˆç‡æ›´é«˜ã€‚</p>

<p>å› ä¸ºå®ƒå®ç°äº†æ‰‹æœºç«¯çš„â€åˆ’è¯ç¿»è¯‘â€ï¼Œåªè¦ä½ åœ¨æ‰‹æœºä¸Šå¤åˆ¶äº†ä»»ä½•è‹±æ–‡å†…å®¹ï¼Œä»–éƒ½ä¼šç›‘å¬ç²˜è´´æ¿ï¼Œç„¶åç»™å‡ºç¿»è¯‘ç»“æœï¼Œå±•ç¤ºåœ¨æ‰‹æœºç•Œé¢ã€‚æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>

<p><img src="http://7xr9gx.com1.z0.glb.clouddn.com/marketing1.pic_hd.jpg" style="width: 50%;margin: auto;" /><br /></p>

<p>å½“ä½ é€‰æ‹©å¤åˆ¶ Reactive è¿™ä¸ªå•è¯åï¼Œå±å¹•æœ€ä¸Šæ–¹å°±ä¼šæ˜¾ç¤ºä¸€ä¸ªæç¤ºæ¡†ï¼Œç”¨äºæ˜¾ç¤ºå•è¯çš„æ„æ€ã€‚</p>

<p>åŒæ—¶ï¼Œè¿˜æ”¯æŒæ”¶è—é™Œç”Ÿå•è¯åˆ°å•è¯æœ¬ã€‚åœ¨è¿™ä¸ªå•è¯æœ¬çš„åŸºç¡€ä¸Šï¼Œæˆ‘åˆåšäº†ä¸€ä¸ªèƒŒå•è¯çš„åŠŸèƒ½ã€‚æ‰‹æœºä¼šæ¯é—´éš”ä¸€æ®µæ—¶é—´ï¼Œåœ¨æ‰‹æœºä¸Šæ˜¾ç¤ºä¸€ä¸ªæç¤ºæ¡†ï¼Œ
ç”¨äºæ˜¾ç¤ºæ·»åŠ åˆ°ç”Ÿè¯æœ¬çš„å•è¯ã€‚</p>

<p>è¿™ä¸ªåŠŸèƒ½å…·ä½“å°±æ˜¯é€šè¿‡å¯åŠ¨åå°æœåŠ¡ï¼Œç„¶åå¼€å¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯é—´éš”ä¸€æ®µæ—¶é—´ï¼Œéšæœºçš„æ˜¾ç¤ºå‡ºç”Ÿè¯æœ¬ä¸­ä¸€ä¸ªå•è¯ã€‚</p>

<p>æ›´å¤šå…³äºå’•å’šç¿»è¯‘çš„ä»‹ç»å¯å‚çœ‹å‰ä¸€ç¯‡æ–‡ç« ï¼Œ<a href="/product/2016/02/26/gudong_translate.html">å…³äºå’•å’šç¿»è¯‘</a></p>

<h2 id="é—®é¢˜">é—®é¢˜</h2>
<p>ä¸Šé¢å·²ç»ç®€å•ä»‹ç»äº†å’•å’šç¿»è¯‘ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼ŒApp ä¸­å¯ä»¥è®¾ç½®æç¤ºå¼¹æ¡†çš„æ˜¾ç¤ºé—´éš”æ—¶é—´ï¼Œå¯ä»¥è®¾ç½®æ¯éš”1åˆ†é’Ÿã€3åˆ†é’Ÿã€5åˆ†é’Ÿæˆ–10åˆ†é’Ÿæ˜¾ç¤ºä¸€æ¬¡ç”Ÿè¯ï¼Œ
è¿™ä¸ªè®¾ç½®æ˜¯åœ¨ MainActivity ä¸­å®Œæˆï¼Œä»£ç å¦‚ä¸‹ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SpUtils.setIntervalTipTime(this, EIntervalTipTime.ONE_MINUTE.name());
</code></pre></div></div>

<p>å…¶å®å°±æ˜¯ç®€å•çš„æ“ä½œäº† SharePreference æŠŠåå¥½è®¾ç½®å­˜å‚¨åœ¨æœ¬åœ°,çœŸå®çš„å­˜å‚¨ä»£ç å¦‚ä¸‹ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public static void putStringPreference(Context context, String key, String value) {       
    SharedPreferences sp = PreferenceManager.getDefaultSharedPreferences(context);
    sp.edit().putString(key, value).apply();
}
</code></pre></div></div>

<p>æŒ‰ç†è¯´ï¼Œä¸Šé¢å®Œæˆäº†è®¾ç½®ï¼Œé‡å¯ service åï¼Œåœ¨ onStartCommand() ä¸­å†æ¬¡æ‰§è¡Œä¸€æ¬¡è®¾ç½®å®šæ—¶ä»»åŠ¡çš„ä»£ç ï¼Œ
é‚£ä¸ªå®šæ—¶æ—¶é—´é—´éš”å°±ä¼šåŒæ—¶æ”¹å˜ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//è·å–æœ¬åœ°è®¾ç½®çš„é—´éš”æ—¶é—´
EIntervalTipTime tipTime = SpUtils.getIntervalTimeWay(this);
int time = tipTime.getIntervalTime();
//é€šè¿‡ RxJava çš„ interval æ“ä½œç¬¦è®¾ç½®å®šæ—¶ä»»åŠ¡
Observable.interval(time, TimeUnit.MINUTES)
        .observeOn(AndroidSchedulers.mainThread())
        .subscribe(new Observer&lt;Long&gt;() {
            @Override
            public void onCompleted() {
                Logger.d("completed");
            }
            @Override
            public void onError(Throwable e) {
                Logger.e("error")ï¼›
            }
            @Override
            public void onNext(Long number) {
                Result result = getResult();
                if(result != null){
                    prepareResultContent(getResult());
                    show(false);
                }
            }
        });
</code></pre></div></div>

<p>ä½†äº‹å®ä¸Šï¼Œæˆ‘è¯•äº†ä¸è¡Œï¼Œä¸è®ºæ€ä¹ˆè®¾ç½®ï¼Œservice ä¸­è·å–åˆ°çš„æ—¶é—´é—´éš”å€¼æ€»æ˜¯ç¬¬ä¸€æ¬¡çš„å€¼ï¼Œé™¤éé€€å‡ºåº”ç”¨é‡æ–°æ‰“å¼€ Appï¼Œæ‰å¯ä»¥ã€‚</p>

<h2 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>è®¾ç½® App çš„ SharedPreferences å±æ€§ä¸º Context.MODE_MULTI_PROCESSã€‚

public static void putStringPreference(Context context, String key, String value) {
    SharedPreferences sp = context.getSharedPreferences(context.getPackageName()+"_preferences",Context.MODE_MULTI_PROCESS);
    sp.edit().putString(key, value).apply();
}
</code></pre></div></div>

<h2 id="åŸå› åˆ†æ">åŸå› åˆ†æ</h2>
<p>å’•å’šç¿»è¯‘ä¸­å¼€å¯äº†ä¸€ä¸ªç›‘å¬ç²˜è´´æ¿çš„æœåŠ¡ï¼Œå¹¶ä¸”é€šè¿‡åœ¨ Manifest æ–‡ä»¶ä¸­æŒ‡å®š process å±æ€§ï¼Œä¸ºè¿™ä¸ªservice æŒ‡å®šäº†å¦ä¸€ä¸ªè¿›ç¨‹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &lt;service
            android:name=".listener.ListenClipboardService"
            android:enabled="true"
            android:exported="true"
            android:process=":process"/&gt; è¿™æ · Application æ‰€åœ¨çš„è¿›ç¨‹å°±å’Œ ListenClipboardService å¤„åœ¨äº†ä¸åŒçš„è¿›ç¨‹ï¼Œæ­¤æ—¶é—®é¢˜æ˜¾è€Œæ˜“è§ï¼Œåœ¨ Application å¯¹åº”çš„è¿›ç¨‹ä¸­è®¾ç½®äº†ä¸€ä¸ªå€¼ï¼Œ å¦ä¸€ä¸ªè¿›ç¨‹å°±ä¸èƒ½åŠæ—¶è·å–åˆ°å¯¹åº”çš„å€¼ã€‚
</code></pre></div></div>

<p>è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡è®¾ç½® SharedPreferences çš„å±æ€§ä¸º Context.MODE_MULTI_PROCESS è§£å†³ï¼Œå…³äºè¿™ä¸ªæ•°å€¼</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> SharedPreference loading flag: when set, the file on disk will be checked for modification even if the shared preferences instance is already loaded in this process. This behavior is sometimes desired in cases where the application has multiple processes, all writing to the same SharedPreferences file. Generally there are better forms of communication between processes, though.
 This was the legacy (but undocumented) behavior in and before Gingerbread (Android 2.3) and this flag is implied when targetting such releases. For applications targetting SDK versions greater than Android 2.3, this flag must be explicitly set if desired.
</code></pre></div></div>

<p>è¿™ä¸ªæ ‡å¿—ä½è¡¨ç¤ºå…è®¸ å¤šä¸ªè¿›ç¨‹å¯ä»¥è®¿é—®åŒä¸€ä¸ª SharePreference å¯¹è±¡ï¼Œå› ä¸ºåœ¨Android 2.3ç‰ˆæœ¬ä¹‹å‰ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å€¼ï¼Œæ‰€ä»¥ä¸å­˜åœ¨é—®é¢˜ï¼Œä½†æ˜¯2.3ä¹‹åå°±éœ€è¦æ‰‹åŠ¨å¼€å¯ã€‚</p>

<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2>
<p><a href="http://stackoverflow.com/questions/23674571/default-shared-preferences-give-me-wrong-values-in-service">Default Shared Preferences give me wrong values in Service</a></p>
:ET